/*
 An jQuery | zepto plugin for lazy loading images.
 author -> jieyou
 see https://github.com/jieyou/lazyload
 use some tuupola's code https://github.com/tuupola/jquery_lazyload (BSD)
 use component's throttle https://github.com/component/throttle (MIT)
*/
(function(f,z){function n(){}function m(a,b){return(b._$container==c?("innerHeight"in h?h.innerHeight:c.height())+c.scrollTop():b._$container.offset().top+b._$container.height())<=a.offset().top-b.threshold}function w(a,b){return(b._$container==c?c.width()+(f.fn.scrollLeft?c.scrollLeft():h.pageXOffset):b._$container.offset().left+b._$container.width())<=a.offset().left-b.threshold}function t(a,b){return(b._$container==c?c.scrollTop():b._$container.offset().top)>=a.offset().top+b.threshold+a.height()}
function x(a,b){return(b._$container==c?f.fn.scrollLeft?c.scrollLeft():h.pageXOffset:b._$container.offset().left)>=a.offset().left+b.threshold+a.width()}function u(a,b){var f=0;a.each(function(c,g){function l(){e.trigger("_lazyload_appear");f=0}var e=a.eq(c);if(!(0>=e.width()&&0>=e.height()||"none"===e.css("display")))if(b.vertical_only){if(!t(e,b))if(!m(e,b))l();else if(++f>b.failure_limit)return!1}else if(!t(e,b)&&!x(e,b))if(!m(e,b)&&!w(e,b))l();else if(++f>b.failure_limit)return!1})}function v(a){return a.filter(function(b,
f){return!a.eq(b)._lazyload_loadStarted})}function y(a,b){function f(){e=0;k=+new Date;l=a.apply(c,g);g=c=null}var c,g,l,e,k=0;return function(){c=this;g=arguments;var a=new Date-k;e||(a>=b?f():e=setTimeout(f,b-a));return l}}var h=window,c=f(h),q={threshold:0,failure_limit:0,event:"scroll",effect:"show",effect_params:null,container:h,data_attribute:"original",data_srcset_attribute:"original-srcset",skip_invisible:!0,appear:n,load:n,vertical_only:!1,check_appear_throttle_time:300,url_rewriter_fn:n,
no_fake_img_loader:!1,placeholder_data_img:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC",placeholder_real_img:"http://ditu.baidu.cn/yyfm/lazyload/0.0.1/img/placeholder.png"},r;r=function(){var a=Object.prototype.toString;return function(b){return a.call(b).replace("[object ","").replace("]","")}}();f.fn.hasOwnProperty("lazyload")||(f.fn.lazyload=function(a){var b=
this,m,p,g;f.isPlainObject(a)||(a={});f.each(q,function(b,e){var k=r(a[b]);-1!=f.inArray(b,["threshold","failure_limit","check_appear_throttle_time"])?"String"==k?a[b]=parseInt(a[b],10):"Number"!=k&&(a[b]=e):"container"==b?(a.hasOwnProperty(b)?a._$container=a[b]==h||a[b]==document?c:f(a[b]):a._$container=c,delete a.container):!q.hasOwnProperty(b)||a.hasOwnProperty(b)&&k==r(q[b])||(a[b]=e)});m="scroll"==a.event;g=0==a.check_appear_throttle_time?u:y(u,a.check_appear_throttle_time);p=m||"scrollstart"==
a.event||"scrollstop"==a.event;b.each(function(c,e){var k=this,d=b.eq(c);c=d.attr("src");e=d.attr("data-"+a.data_attribute);var g=a.url_rewriter_fn==n?e:a.url_rewriter_fn.call(k,d,e),h=d.attr("data-"+a.data_srcset_attribute),m=d.is("img");if(1==d._lazyload_loadStarted||c==g)d._lazyload_loadStarted=!0,b=v(b);else if(d._lazyload_loadStarted=!1,m&&!c&&d.one("error",function(){d.attr("src",a.placeholder_real_img)}).attr("src",a.placeholder_data_img),d.one("_lazyload_appear",function(){function c(){l&&
d.hide();m?(h&&d.attr("srcset",h),g&&d.attr("src",g)):d.css("background-image",'url("'+g+'")');l&&d[a.effect].apply(d,e?a.effect_params:[]);b=v(b)}var e=f.isArray(a.effect_params),l;if(!d._lazyload_loadStarted)if(l="show"!=a.effect&&f.fn[a.effect]&&(!a.effect_params||e&&0==a.effect_params.length),a.appear!=n&&a.appear.call(k,d,b.length,a),d._lazyload_loadStarted=!0,a.no_fake_img_loader||h){if(a.load!=n)d.one("load",function(){a.load.call(k,d,b.length,a)});c()}else f("<img />").one("load",function(){c();
a.load!=n&&a.load.call(k,d,b.length,a)}).attr("src",g)}),!p)d.on(a.event,function(){d._lazyload_loadStarted||d.trigger("_lazyload_appear")})});if(p)a._$container.on(a.event,function(){g(b,a)});c.on("resize load",function(){g(b,a)});f(function(){g(b,a)});return this})})(Zepto);